<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfil | Skill Market</title>
    <link rel="stylesheet" href="css/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
<header id="Pagina_Principal_Header">
    <div class="header-group-left">
        <img id="imgmenu" src="/images/menu.png" alt="imgmenu">
        <a href="index.html"><img id="imglogo" src="/images/image.png" alt="logotipo do site"></a>
    </div>
    <nav class="header-group-center">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="somos.html">Sobre N贸s</a></li>
            <li><a href="help.html">Help?</a></li>
        </ul>
    </nav>

    <div class="header-group-right">
        <ul class="auth-links" id="auth-links">
            <li id="signup-link"><a href="signup.html">Sign Up</a></li>
            <li id="signin-link"><a href="signin.html">Sign In</a></li>
        </ul>
        <div class="perfil-container" id="profile-container">
            <ul class="perfil-principal">
                <li class="perfil">
                    <a href="#"><img id="imgperfil" src="/images/perfil.jpeg" alt="Imagem de perfil"></a>
                    <ul class="submenu">
                        <li><a id="view-profile-link" href="#">Acessar Perfil</a></li>
                        <li><a id="edit-profile-link" href="#">Editar perfil</a></li>
                        <li><a href="#">Configura莽玫es</a></li>
                        <li><a id="logout-link" href="#">Sair (Logout)</a></li> 
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</header>

    <section class="page">
        <section class="perfil-topo">
            <img src="images/perfil.jpeg" alt="Foto de Perfil" class="foto-perfil" />
            <div>
                <h2 id="profile-name">Carregando...</h2>
                <p id="profile-title" class="titulo-profissional"></p>
                <p id="profile-location" class="localizacao"></p>
            </div>
        </section>

        <section class="sobre">
            <h3>Sobre mim</h3>
            <p id="profile-about"></p>
        </section>

        <section class="habilidades">
            <h3>Habilidades</h3>
            <ul id="profile-skills"></ul>
        </section>

        <section class="portfolio">
            <h3>Portf贸lio</h3>
            <div id="profile-portfolio" class="galeria">
            </div>
        </section>

        <section class="contato">
            <h3>Contatos</h3>
            <div id="profile-contacts">
            </div>
        </section>
    </section>

    <footer class="foothome">
        <p>&copy; 2025 Skill Market. Todos os direitos reservados.</p>
    </footer>

<script>
    document.addEventListener('DOMContentLoaded', async function () {
        const params = new URLSearchParams(window.location.search);
        const userId = params.get('id');

        if (!userId) {
            alert('Nenhum perfil especificado.');
            window.location.href = 'index.html';
            return;
        }

        try {
            const response = await fetch(`http://localhost:3000/api/profile/${userId}`);

            if (!response.ok) {
                document.querySelector('.page').innerHTML = '<h1>Perfil n茫o encontrado.</h1>';
                return;
            }

            const perfil = await response.json();

            document.querySelector('.perfil-topo h2').textContent = perfil.full_name;
            document.querySelector('.titulo-profissional').textContent = perfil.title;
            document.querySelector('.localizacao').textContent = ` ${perfil.location}`;
            if (perfil.profile_image_url) {
                document.querySelector('.foto-perfil').src = `http://localhost:3000${perfil.profile_image_url}`;
            }
            document.querySelector('.sobre p').textContent = perfil.about;

            const habilidadesUl = document.querySelector('.habilidades ul');
            habilidadesUl.innerHTML = '';
            if (perfil.skills) {
                perfil.skills.split(',').forEach(h => {
                    const li = document.createElement('li');
                    li.textContent = `锔 ${h.trim()}`;
                    habilidadesUl.appendChild(li);
                });
            }

            const galeria = document.querySelector('.portfolio .galeria');
            galeria.innerHTML = '';
            if (perfil.portfolio && perfil.portfolio.length > 0) {
                perfil.portfolio.forEach(item => {
                    const img = document.createElement('img');
                    img.src = `http://localhost:3000${item.image_url}`;
                    img.alt = 'Projeto do Portf贸lio';
                    galeria.appendChild(img);
                });
            } else {
                galeria.innerHTML = '<p>Nenhum item de portf贸lio adicionado.</p>';
            }

            const contatoDiv = document.querySelector('.contato div');
            contatoDiv.innerHTML = '';

            if (perfil.contact_email) {
                contatoDiv.innerHTML += `<p><img src="images/logogmail.png" alt="Email"> <a href="mailto:${perfil.contact_email}">${perfil.contact_email}</a></p>`;
            }
            if (perfil.phone) {
                contatoDiv.innerHTML += `<p><img src="images/wpp.png" alt="WhatsApp"> <a href="https://wa.me/${perfil.phone.replace(/\D/g,'')}" target="_blank">${perfil.phone}</a></p>`;
            }
            if (perfil.instagram_url) {
                const username = perfil.instagram_url.split('/').filter(Boolean).pop();
                contatoDiv.innerHTML += `<p><img src="images/logoinsta.png" alt="Instagram"> <a href="${perfil.instagram_url}" target="_blank">@${username}</a></p>`;
            }
            if (perfil.website_url) {
                contatoDiv.innerHTML += `<p><img src="images/link.png" alt="Website"> <a href="${perfil.website_url}" target="_blank">Site / Portf贸lio</a></p>`;
            }
            if (contatoDiv.innerHTML === '') {
                contatoDiv.innerHTML = '<p>Nenhuma informa莽茫o de contato adicionada.</p>';
            }

        } catch (error) {
            console.error('Erro ao buscar dados do perfil:', error);
            document.querySelector('.page').innerHTML = '<h1>Erro ao carregar o perfil.</h1>';
        }
    });
</script>
    <script src="js/header.js"></script>
</body>
</html>